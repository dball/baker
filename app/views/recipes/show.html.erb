<% title 'recipes ' + @recipe.name.titleize.to_json %>
<table id="ingredients">
  <thead>
    <tr>
      <th>Ingredient</th>
      <th>%</th>
      <th>
        <% form_tag(@recipe, :method => :get, :class => 'autosubmit') do %>
          <div style="display: inline">
            <select name="weight_unit">
              <%= options_from_collection_for_select(@weight_units, :id, :abbr, @recipe.weight_unit.id) %>
            </select>
            <label for="scale">Scale:</label>
            <%= text_field_tag(:scale, sprintf('%g', @recipe.scale), :size => 3) %>
          </div>
        <% end %>
      </th>
    </tr>
  </thead>
  <tbody>
    <% @recipe.ingredients.each do |ingredient| %>
      <tr>
        <td>
          <% if ingredient.subrecipe %>
            <%= link_to h(ingredient.subrecipe.name), ingredient.subrecipe %>
          <% else %>
            <%= ingredient.name %>
          <% end %>
        </td>
        <td class="percent"><%= ingredient.percent %></td>
        <td class="weight"><%= ingredient.weight %></td>
      </tr>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <td>TOTAL</td>
      <td class="percent"><%= @recipe.total_percent %></td>
    </tr>
  </tfoot>
</table>
